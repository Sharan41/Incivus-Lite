"use strict";(self.webpackChunkshopify_incivus_ui=self.webpackChunkshopify_incivus_ui||[]).push([[433],{9433:(e,n,i)=>{i.d(n,{firebaseOfflineMode:()=>t});class o{constructor(){this.isOffline=!1,this.errorCount=0,this.maxErrors=5,this.offlineData=new Map,this.setupErrorMonitoring()}setupErrorMonitoring(){var e=this;const n=window.fetch;window.fetch=async function(){for(var i=arguments.length,o=new Array(i),t=0;t<i;t++)o[t]=arguments[t];try{const i=await n(...o);return o[0]&&o[0].includes("firestore.googleapis.com")&&400===i.status&&e.recordError(),i}catch(r){throw o[0]&&o[0].includes("firestore.googleapis.com")&&e.recordError(),r}},window.addEventListener("unhandledrejection",e=>{this.isFirebaseError(e.reason)&&this.recordError()})}isFirebaseError(e){var n,i,o,t;return!!e&&((null===(n=e.message)||void 0===n?void 0:n.includes("firebase"))||(null===(i=e.message)||void 0===i?void 0:i.includes("firestore"))||(null===(o=e.message)||void 0===o?void 0:o.includes("WebChannelConnection"))||(null===(t=e.message)||void 0===t?void 0:t.includes("400"))||"unavailable"===e.code)}recordError(){this.errorCount++,console.warn(`\ud83d\udd25 Firebase error recorded (${this.errorCount}/${this.maxErrors})`),this.errorCount>=this.maxErrors&&!this.isOffline&&this.enableOfflineMode()}enableOfflineMode(){this.isOffline=!0,console.warn("\ud83d\udeab Firebase offline mode ENABLED due to persistent connection issues"),this.showOfflineNotification(),window.dispatchEvent(new CustomEvent("firebase-offline-mode-enabled",{detail:{message:"Firebase offline mode enabled due to connection issues",timestamp:(new Date).toISOString()}}))}disableOfflineMode(){this.isOffline=!1,this.errorCount=0,console.log("\u2705 Firebase offline mode DISABLED - connection restored"),window.dispatchEvent(new CustomEvent("firebase-offline-mode-disabled",{detail:{message:"Firebase connection restored",timestamp:(new Date).toISOString()}}))}showOfflineNotification(){const e=document.createElement("div");e.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: #ff6b6b;\n      color: white;\n      padding: 15px;\n      border-radius: 8px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n      z-index: 10000;\n      font-family: sans-serif;\n      font-size: 14px;\n      max-width: 300px;\n    ",e.innerHTML='\n      <strong>\u26a0\ufe0f Firebase Offline Mode</strong><br>\n      Connection issues detected. Using local storage.\n      <button onclick="this.parentElement.remove()" style="\n        float: right;\n        background: none;\n        border: none;\n        color: white;\n        cursor: pointer;\n        font-size: 16px;\n        margin-left: 10px;\n      ">\u2715</button>\n    ',document.body.appendChild(e),setTimeout(()=>{e.parentElement&&e.remove()},1e4)}async safeFirebaseOperation(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isOffline)return console.warn("\ud83d\udeab Firebase operation blocked - offline mode active"),n;try{return await e()}catch(i){return console.error("\ud83d\udd25 Firebase operation failed:",i),this.recordError(),n}}setOfflineData(e,n){this.offlineData.set(e,{data:n,timestamp:Date.now()})}getOfflineData(e){const n=this.offlineData.get(e);if(n){if(Date.now()-n.timestamp<36e5)return n.data;this.offlineData.delete(e)}return null}isInOfflineMode(){return this.isOffline}resetErrorCount(){this.errorCount=0}forceOfflineMode(){this.enableOfflineMode()}forceOnlineMode(){this.disableOfflineMode()}}const t=new o}}]);
//# sourceMappingURL=433.fea0a81a.chunk.js.map