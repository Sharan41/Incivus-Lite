"use strict";(self.webpackChunkshopify_incivus_ui=self.webpackChunkshopify_incivus_ui||[]).push([[178],{7178:(e,a,s)=>{s.d(a,{checkQuotaFromSingleSource:()=>t,getPlanDataFromSingleSource:()=>o});var n=s(377);const o=async e=>{try{var a,s;console.log("\ud83d\udd0d PlanDataHelper - Fetching from single source of truth..."),console.log("\ud83d\udd0d PlanDataHelper - Using userId:",e),console.log("\ud83d\udd0d PlanDataHelper - API URL:",`${n.F.PYTHON_API_URL}/get-user-profile/${e}`);const o=await fetch(`${n.F.PYTHON_API_URL}/get-user-profile/${e}`);if(!o.ok)return console.warn("\u26a0\ufe0f PlanDataHelper - Failed to fetch from single source:",o.status),null;const t=await o.json();if(console.log("\ud83d\udd0d PlanDataHelper - Raw API response:",t),!t.subscription)return console.warn("\u26a0\ufe0f PlanDataHelper - No subscription data found in response"),null;console.log("\ud83d\udd0d PlanDataHelper - Raw subscription data:",t.subscription);const r={lite:4,plus:5,pro:11,enterprise:999}[null===(a=t.subscription.planType)||void 0===a?void 0:a.toLowerCase()]||t.subscription.max_ads_per_month,i=t.subscription.adsUsed||0,l=t.subscription.adQuota||0,c={...t.subscription,max_ads_per_month:r,adsUsed:i,adQuota:l,planType:t.subscription.planType,planName:t.subscription.planName,isActive:!1!==t.subscription.isActive,subscribed:!1!==t.subscription.subscribed,selectedFeatures:t.subscription.selectedFeatures||t.subscription.features||[],features:t.subscription.selectedFeatures||t.subscription.features||[],monthlyRemaining:Math.max(0,r-i),remainingAds:Math.max(0,l),maxAdsPerMonth:r};return console.log("\u2705 PlanDataHelper - Plan data from single source:",{planType:c.planType,adsUsed:c.adsUsed,maxAdsPerMonth:c.max_ads_per_month,adQuota:c.adQuota,monthlyRemaining:c.monthlyRemaining,remainingAds:c.remainingAds,selectedFeatures:c.selectedFeatures,featuresCount:(null===(s=c.selectedFeatures)||void 0===s?void 0:s.length)||0}),console.log("\ud83d\udd0d PlanDataHelper - FULL processed plan data:",c),c}catch(o){return console.error("\u274c PlanDataHelper - Error fetching from single source:",o),null}},t=async e=>{try{const a=await o(e);if(!a)return{canAnalyze:!1,reason:"No plan data found",adsUsed:0,maxAdsPerMonth:0,adQuota:0};const s=a.adsUsed||0,n=a.max_ads_per_month||0,t=a.adQuota||0,r=s>=n,i=t<=0,l=!r&&!i;return console.log("\ud83d\udd0d QuotaCheck - Single source quota status:",{adsUsed:s,maxAdsPerMonth:n,totalQuota:t,monthlyLimitReached:r,totalLimitReached:i,canAnalyze:l}),{canAnalyze:l,reason:r?"Monthly limit reached":i?"Total quota exhausted":"OK",adsUsed:s,maxAdsPerMonth:n,adQuota:t,monthlyRemaining:Math.max(0,n-s)}}catch(a){return console.error("\u274c QuotaCheck - Error checking quota from single source:",a),{canAnalyze:!1,reason:"Error checking quota",adsUsed:0,maxAdsPerMonth:0,adQuota:0}}}}}]);
//# sourceMappingURL=178.3d7a7c5d.chunk.js.map